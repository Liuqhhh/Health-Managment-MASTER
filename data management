// routes/healthData.js  
const express = require('express');  
const router = express.Router();  
const HealthData = require('../models/HealthData');  
const jwtMiddleware = require('../middlewares/jwtMiddleware');  
  
// Add health data  
router.post('/', jwtMiddleware, async (req, res) => {  
  const { weight, bloodPressure, bloodSugar } = req.body;  
  const healthData = new HealthData({  
    userId: req.user.userId,  
    weight,  
    bloodPressure,  
    bloodSugar  
  });  
  try {  
    await healthData.save();  
    await User.findByIdAndUpdate(req.user.userId, { $push: { healthData: healthData._id } }, { new: true });  
    res.status(201).send('Health data added successfully');  
  } catch (error) {  
    res.status(400).send(error.message);  
  }  
});  
  
// Get health data history  
router.get('/', jwtMiddleware, async (req, res) => {  
  try {  
    const healthData = await HealthData.find({ userId: req.user.userId }).sort({ date: -1 });  
    res.json(healthData);  
  } catch (error) {  
    res.status(500).send('Server error');  
  }  
});  
  
module.exports = router;
